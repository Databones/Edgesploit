// ==UserScript==
// @name         Edgesploit 1.7
// @version      1.7
// @author       Databones
// @namespace    https://discord.gg/HQmSYGK8tV
// @description  Edgenuity does not care about your user experience. We do. Spread this script to your classmates in protest of Edgenuity purposely staying as an outdated, unfulfilling platform! :)
// @icon         https://raw.githubusercontent.com/Databones/Edgesploit/main/img/logo.png
// @match        *://*.core.learn.edgenuity.com/*
// @match        *://student.edgenuity.com/*
// @grant        GM_addStyle
// @grant        GM_setValue
// @grant        GM_getValue
// ==/UserScript==

// â”€â”€  CHANGELOG  â”€â”€
// âž• New logo!
// âž• Fancier UI design
// âž• Added separate "Home" and "Coursemap" buttons
// âž• Added easter egg somewhere (i forgrot ðŸ’€)
// ðŸ”§ Fixed the menu's functionality along with several features
// ðŸ”§ Themes show more background
// ðŸ”§ Script will now autoclick on the activity tile

!function(){"use strict";if(GM_getValue("themes",!1)&&(document.body.style.backgroundColor="transparent"),window.top!==window.self)return;document.addEventListener("keydown",(function(e){if(e.shiftKey&&"Z"===e.key){const e=document.getElementById("edgesploitMenuContainer"),t=document.getElementById("edgesploitBackgroundOverlay");"none"===e.style.display?(e.style.display="block",t.style.display="block"):(e.style.display="none",t.style.display="none")}})),document.addEventListener("keydown",(e=>{if(e.shiftKey&&"D"===e.key){const e=document.getElementById("edgesploitMenuButton"),t="none"===e.style.display||""===e.style.display;e.style.display=t?"block":"none",GM_setValue("menuButtonHidden",!t)}})),window.addEventListener("load",(()=>{document.getElementById("edgesploitMenuButton").style.display=GM_getValue("menuButtonHidden",!1)?"none":"block"}));"undefined"!=typeof GM_info&&GM_info.script&&async function(){const e=await fetch("https://raw.githubusercontent.com/Databones/Edgesploit/main/version"),t=await e.text(),n=GM_info.script.version;t.trim()!==n.trim()&&(window.location.href="https://github.com/Databones/Edgesploit/raw/main/Edgesploit.user.js")}();const e=document.createElement("button");e.id="edgesploitMenuButton",e.style.position="fixed",e.style.bottom="20px",e.style.right="20px",e.style.zIndex="9999",e.style.background="transparent",e.style.border="none",e.style.padding="20px",e.style.cursor="pointer",e.style.backgroundImage='url("https://raw.githubusercontent.com/Databones/Edgesploit/main/img/logo.png")',e.style.backgroundSize="contain";const t=GM_getValue("menuButtonYPosition","20px");e.style.bottom=t,document.body.appendChild(e);let n=!1,o=0;e.addEventListener("mousedown",(e=>{n=!0,o=e.clientY})),document.addEventListener("mousemove",(t=>{if(n){const n=o-t.clientY,a=parseInt(e.style.bottom)+n,s=20,i=window.innerHeight-e.clientHeight-20,l=Math.min(i,Math.max(s,a));e.style.bottom=`${l}px`,o=t.clientY,GM_setValue("menuButtonYPosition",`${l}px`)}})),document.addEventListener("mouseup",(()=>{n=!1}));const a=document.createElement("div");a.id="edgesploitBackgroundOverlay",a.style.display="none",a.style.position="fixed",a.style.top="0",a.style.left="0",a.style.width="100%",a.style.height="100%",a.style.backgroundColor="rgba(0, 0, 0, 0.5)",a.style.zIndex="9998",a.style.backdropFilter="blur(5px)",document.body.appendChild(a),a.addEventListener("click",(()=>{d()}));const s=document.createElement("div");s.id="edgesploitMenuContainer",s.style.display="none",s.style.position="fixed",s.style.userSelect="none",s.style.top="50%",s.style.background="linear-gradient(45deg, #333, #a32939)",s.style.left="50%",s.style.transform="translate(-50%, -50%)",s.style.zIndex="9999",s.style.width="400px",s.style.padding="30px",s.style.color="#FFF",s.style.borderRadius="10px",s.style.boxShadow="0px 0px 10px rgba(0, 0, 0, 0.5)",s.style.transition="transform 0.2s ease-in-out",document.body.appendChild(s);const i=document.createElement("h2");i.style.textAlign="center",i.style.marginBottom="10px",i.style.fontSize="24px",i.textContent="â¸» Edgesploit 1.7 â¸»",s.appendChild(i);let l=0;i.addEventListener("click",(function(){l++,l>=30&&(i.textContent="â¸» HuntxyBot 1.69 â¸»",l=0,setTimeout((()=>{i.textContent="â¸» Edgesploit 1.7 â¸»"}),500))}));const r=document.createElement("button");r.textContent="Apply changes?",r.style.marginTop="10px",r.style.padding="5px 10px",r.style.backgroundColor="#111",r.style.color="#FFF",r.style.border="none",r.style.borderRadius="5px",r.style.cursor="pointer",r.style.border="1px solid transparent",r.style.transition="border-color 0.1s ease-out",r.addEventListener("mouseenter",(()=>{r.style.borderColor="#FFF"})),r.addEventListener("mouseleave",(()=>{r.style.borderColor="transparent"})),r.addEventListener("click",(()=>{location.reload()})),s.appendChild(r);const c=document.createElement("button");c.textContent="Set background",c.style.marginTop="10px",c.style.marginLeft="10px",c.style.padding="5px 10px",c.style.backgroundColor="#111",c.style.color="#FFF",c.style.border="none",c.style.borderRadius="5px",c.style.cursor="pointer",c.style.border="1px solid transparent",c.style.transition="border-color 0.1s ease-out",c.addEventListener("mouseenter",(()=>{c.style.borderColor="#FFF"})),c.addEventListener("mouseleave",(()=>{c.style.borderColor="transparent"})),c.addEventListener("click",(()=>{const e=prompt("Please enter the URL for the custom background:");null!==e&&""!==e.trim()&&(u.bgImageUrl=e,GM_setValue("bgImageUrl",e),w())})),s.appendChild(c);const d=()=>{const e="none"===s.style.display?"block":"none";s.style.display=e,a.style.display=e};e.addEventListener("click",d);const u={activityAdvance:GM_getValue("activityAdvance",!0),frameAdvance:GM_getValue("frameAdvance",!0),answerGuesser:GM_getValue("answerGuesser",!0),skipIntros:GM_getValue("skipIntros",!0),frameBypass:GM_getValue("frameBypass",!0),duplicateTabs:GM_getValue("duplicateTabs",!0),showColumns:GM_getValue("showColumns",!0),autoVocab:GM_getValue("autoVocab",!0),antiLogout:GM_getValue("antiLogout",!0),labAdvance:GM_getValue("labAdvance",!0),themes:GM_getValue("themes",!0)},m=document.createElement("ul");m.style.listStyleType="none",m.style.padding="0";const y={activityAdvance:"Activity Advance",frameAdvance:"Frame Advance",answerGuesser:"Answer Guesser",skipIntros:"Skip Intros",frameBypass:"Frame Bypass",duplicateTabs:"Duplicate Tabs",showColumns:"Show Columns",autoVocab:"Auto Vocab",antiLogout:"Anti Logout",labAdvance:"Lab Advance",themes:"Themes"},p={activityAdvance:"Advances to the next activity when the current one is complete.",frameAdvance:"Automatically clicks to the next frame.",answerGuesser:"Selects random answers for non-graded activities.",skipIntros:"Removes introduction screens that block your inputs.",frameBypass:"Removes frame restrictions to freely navigate through activities.",duplicateTabs:"Allows opening multiple tabs.",showColumns:"Shows every hidden question in assignments.",autoVocab:"Fills in vocabulary answers in Vocabulary activities.",antiLogout:"Prevents automatic logouts from inactivity.",labAdvance:"Automatically advances in Virtual Lab activities.",themes:"Replaces Edgenuity's depressing background with any background you want."};for(const e in u)if(u.hasOwnProperty(e)){const t=document.createElement("button");t.className="setting-button",t.textContent=y[e],t.title=p[e],t.style.marginTop="10px",t.style.padding="5px 15px 5px 40px",t.style.backgroundColor="#111",t.style.color="#FFF",t.style.border="none",t.style.borderRadius="5px",t.style.cursor="pointer",t.style.display="block",t.style.width="100%",t.style.textAlign="left";const n={activityAdvance:"https://raw.githubusercontent.com/Databones/Edgesploit/main/img/icons/Activity_Advance.png",frameAdvance:"https://raw.githubusercontent.com/Databones/Edgesploit/main/img/icons/Frame_Advance.png",frameBypass:"https://raw.githubusercontent.com/Databones/Edgesploit/main/img/icons/Frame_Bypass.png",antiLogout:"https://raw.githubusercontent.com/Databones/Edgesploit/main/img/icons/Anti_Logout.png",showColumns:"https://raw.githubusercontent.com/Databones/Edgesploit/main/img/icons/Show_Columns.png",answerGuesser:"https://raw.githubusercontent.com/Databones/Edgesploit/main/img/icons/Answer_Guesser.png",labAdvance:"https://raw.githubusercontent.com/Databones/Edgesploit/main/img/icons/Lab_Advance.png",duplicateTabs:"https://raw.githubusercontent.com/Databones/Edgesploit/main/img/icons/Duplicate_Tabs.png",autoVocab:"https://raw.githubusercontent.com/Databones/Edgesploit/main/img/icons/Auto_Vocab.png",skipIntros:"https://raw.githubusercontent.com/Databones/Edgesploit/main/img/icons/Skip_Intros.png",themes:"https://raw.githubusercontent.com/Databones/Edgesploit/main/img/icons/Themes.png"};t.style.border="1px solid transparent",t.style.transition="border-color 0.1s ease-out",t.addEventListener("mouseenter",(()=>{t.style.borderColor="#FFF"})),t.addEventListener("mouseleave",(()=>{t.style.borderColor="transparent"})),t.style.backgroundImage=`url('${n[e]}')`,t.style.backgroundSize="30px 30px",t.style.backgroundRepeat="no-repeat",t.style.backgroundPosition="10px center";const o=document.createElement("img");o.src="https://raw.githubusercontent.com/Databones/Edgesploit/main/img/enabled.png",o.alt="enabled",o.style.width="20%";const a=document.createElement("img");a.src="https://raw.githubusercontent.com/Databones/Edgesploit/main/img/disabled.png",a.alt="disabled",a.style.width="20%",t.appendChild(o),t.appendChild(a),o.style.display=u[e]?"inline":"none",a.style.display=u[e]?"none":"inline",t.addEventListener("click",(()=>{u[e]=!u[e],GM_setValue(e,u[e]),o.style.display=u[e]?"inline":"none",a.style.display=u[e]?"none":"inline"}));const s=document.createElement("li");s.appendChild(t),m.appendChild(s)}function g(e){e.click()}function b(){const e=document.getElementById("activity-title").innerText,t=document.getElementById("stageFrame").contentWindow.document,n=t.querySelectorAll("form .answer-choice-button");if(["Instruction","Warm-Up","Summary","Lecture","Virtual Lab","Drafting","Prewriting","Part","Case Study","Overview","Career Connection","Wrap"].includes(e)){if(n.length>0){g(n[Math.floor(Math.random()*n.length)])}else{const e=t.querySelector("iframe").contentWindow.document.querySelectorAll(".answer-choice-button");if(e.length>0){g(e[Math.floor(Math.random()*e.length)])}}t.querySelector("iframe").contentWindow.document.querySelectorAll("div[fdone]").forEach((function(e){e.click()}))}}function v(){var e=document.getElementById("activity-title");e&&"Vocabulary"===e.innerText&&function(){var e=document.getElementById("activity-title");if("Vocabulary"===e.textContent){var t=document.querySelector("#stageFrame").contentDocument,n=t.querySelector(".word-background"),o=t.querySelector(".word-textbox"),a=t.querySelector(".uibtn.uibtn-blue.uibtn-arrow-next");if(a&&n&&o){var s=n.value;o.value=s;var i=new Event("keyup");o.dispatchEvent(i),a.click();var l=t.querySelectorAll(".playbutton.vocab-play");l.length>0&&(l[0].click(),l[1].click()),setTimeout((function(){a.click()}),1500)}}}(),setTimeout(v,1e3)}function h(){for(var e=document.querySelectorAll("iframe"),t=0;t<e.length;t++)for(var n=e[t].contentDocument.querySelectorAll("iframe"),o=0;o<n.length;o++){var a=n[o].contentDocument.querySelector(".right-column"),s=n[o].contentDocument.querySelector(".left-column");a&&a.children[0].removeAttribute("style"),s&&s.children[0].removeAttribute("style");for(var i=n[o].contentDocument.querySelectorAll('div[fstack][style="display:none;"]'),l=0;l<i.length;l++)i[l].removeAttribute("style")}}function f(){if(GM_getValue("clickActivityTile",!1)){function n(){const e=document.querySelector(".ActivityTile-border-current.text-dark.ActivityTile.card.flex-row.ActivityTile-status-current.link-nostyle");e&&e.click()}new MutationObserver((function(e){n()})).observe(document.body,{childList:!0,subtree:!0}),n()}const e=setInterval((()=>{const t=document.getElementsByName("stageFrame")[0]?.contentWindow?.API,n=document.getElementById("activity-status")?.innerText.toLowerCase();(t&&t.FrameChain.isComplete()||"complete"===n||"bypassed"===n)&&clearInterval(e)}),3e3),t=()=>{!function(){var e=document.getElementById("activity-status");if(u.activityAdvance&&e&&"Complete"===e.innerText.trim()){var t=document.querySelector('a[data-bind="visible: ReturnURL, attr: { href: ReturnURL }, click: goHome"]');if(t){var n=t.getAttribute("href");window.location.href=n}}}(),setTimeout(t,1500)};t()}function w(){const e=document.querySelector(".mainhead");e.style.backgroundColor="transparent",e.style.webkitBoxShadow="none",e.style.boxShadow="none";const t=document.getElementsByClassName("mainfoot");for(const e of t)e.style.background="none",e.style.webkitBoxShadow="none",e.style.boxShadow="none";const n=u.bgImageUrl||"https://raw.githubusercontent.com/Databones/Edgesploit/main/img/background.webp";GM_addStyle(`\n    body {\n        background-image: url(${n});\n        background-repeat: no-repeat;\n    }\n    `);window.location.href.match(/^https?:\/\/.*\.core\.learn\.edgenuity\.com\/.*/)&&GM_setValue("clickActivityTile",!0);const o=document.querySelector("a.nav-home.nav");if(o&&(o.removeAttribute("class"),o.innerHTML='<img src="https://raw.githubusercontent.com/Databones/Edgesploit/main/img/coursemap.png" alt="Coursemap">'),e){const t=document.createElement("a");t.href="https://student.edgenuity.com",t.className="nav-home nav",t.setAttribute("data-bind","visible: ReturnURL"),t.innerText="Home",e.insertBefore(t,e.firstChild),t.addEventListener("click",(function(){GM_setValue("clickActivityTile",!1)})),o.addEventListener("click",(function(){GM_setValue("clickActivityTile",!1)}))}}function E(){setInterval((function(){var e=document.getElementById("timerStay");e&&e.click()}),1500);const e=document.querySelectorAll("#yesButton");for(const t of e)setTimeout((()=>{t.click()}),1e3)}s.appendChild(m);if(GM_getValue("antiLogout",!1)){new MutationObserver(((e,t)=>{for(const t of e)if("childList"===t.type){document.querySelectorAll(".modal-dialog.session-timeout-modal").length>0&&E()}})).observe(document,{childList:!0,subtree:!0})}window.addEventListener("load",(function(){var e;u.frameAdvance&&setInterval((function(){var e=document.getElementById("stageFrame"),t=document.getElementById("activity-status");if(e&&t&&"Complete"!==t.innerText.trim()){var n=e.contentDocument.querySelector(".FrameRight");n&&n.click()}}),500),u.activityAdvance&&f(),u.skipIntros&&(e=document.getElementById("stageFrame")).addEventListener("load",(function(){var t=e.contentDocument.querySelector("#invis-o-div");t&&t.remove()})),u.frameBypass&&function(){var e=document.getElementById("stageFrame");e&&e.addEventListener("load",(function(){e.contentWindow.API&&e.contentWindow.API.E2020&&(e.contentWindow.API.E2020.freeMovement=!0)}))}(),u.answerGuesser&&setInterval(b,1e3),u.showColumns&&setInterval(h,750),u.autoVocab&&v(),u.labAdvance&&function(){var e=document.getElementById("activity-title").innerText,t=document.getElementById("stageFrame").contentWindow.document;"Virtual Lab"===e&&setInterval((function(){t.dispatchEvent(new KeyboardEvent("keydown",{keyCode:32})),t.dispatchEvent(new KeyboardEvent("keyup",{keyCode:32}))}),300)}(),u.antiLogout&&E(),u.duplicateTabs&&function(){const e=new Set(["RecentPageID","WrongPageID"]),t=localStorage.setItem.bind(localStorage),n=localStorage.getItem.bind(localStorage);localStorage.setItem=(n,o)=>{e.has(n)||t(n,o)},localStorage.getItem=t=>e.has(t)?null:n(t),e.forEach((e=>localStorage.removeItem(e)))}(),u.themes&&w()}))}(),function(){"use strict";document.addEventListener("keydown",(function(e){e.shiftKey&&"Y"===e.key&&(function(){const e=document.querySelector(".ReactModalPortal");e&&(e.innerHTML='\n        <div class="ReactModalPortal">\n          <div class="ReactModal__Overlay ReactModal__Overlay--after-open" style="position: fixed; inset: 0px; background-color: rgba(255, 255, 255, 0.75);">\n            <div class="ReactModal__Content ReactModal__Content--after-open modal-dialog session-timeout-modal" tabindex="-1" role="dialog" aria-modal="true">\n              <div class="modal-content">\n                <div class="modal-header">\n                  <h4 class="modal-title">Are You Still Working?</h4>\n                </div>\n                <div class="modal-body">\n                  <div class="warningIcon fa fa-exclamation-triangle"></div>\n                  <div class="timeoutTimer">2:16</div>\n                  <h4>You don\'t seem to be active. Are you still working? </h4>\n                </div>\n                <div class="modal-footer">\n                  <button type="button" class="btn btn-secondary">\n                    <div class="sessionTimeoutYesNo">No</div>\n                  </button>\n                  <button type="button" class="btn btn-primary" id="yesButton">\n                    <div class="sessionTimeoutYesNo">Yes</div>\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      ')}(),function(){const e=document.getElementById("yesButton");e&&e.addEventListener("click",(function(){e.innerHTML='<div class="sessionTimeoutYesNo">Thanks</div>'}))}())}))}();
